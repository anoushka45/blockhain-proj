<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Contract Vulnerability Detector</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.7.4/web3.min.js"></script>
    <script defer src="app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: url("https://www.chainalysis.com/wp-content/uploads/2022/02/bloggraphic-blockchains-01-1.png") no-repeat center center fixed;
            background-size: cover;
          
            /* Text color for better readability */
        }

        * Modern Navbar */ .navbar {
            background: #0d6efd;
            box-shadow: 0px 2px 10px rgba(0, 0, 0, 0.1);
        }

        .navbar-brand {
            color: #fff !important;
            font-weight: 600;
            font-size: 20px;
        }

        .container-box {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            text-align: center;
            margin: 80px auto;
        }

        #output {
            background: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            white-space: pre-wrap;
            min-height: 50px;
        }

        .chart-container {
            margin-top: 20px;
            width: 100%;
        }

        .footer {
            text-align: center;
            padding: 15px;
            margin-top: 20px;
            background-color: #343a40;
            color: white;
        }
    </style>
</head>

<body>

    <!-- Modern Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">üîç Vulnerability Detector</a>
        </div>
    </nav>

    <div class="container-box">
        <h2 class="mb-2">Smart Contract Vulnerability Detector</h2>
        <p class="text-muted">Upload a Solidity smart contract file to scan for potential security vulnerabilities.</p>

        <div class="mb-3">
            <input type="file" id="fileInput" class="form-control" />
        </div>
        <button class="btn btn-primary" onclick="checkVulnerabilities()">Analyze</button>
        <pre id="output" class="mt-3"></pre>

        <!-- Chart Container -->
        <div class="chart-container">
            <canvas id="vulnChart"></canvas>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        ¬© 2024 Smart Contract Security Scanner. All Rights Reserved.
    </div>

    <script>
        function checkVulnerabilities() {
            const fileInput = document.getElementById("fileInput");
            const file = fileInput.files[0];
            if (!file) return alert("Please select a file!");

            const formData = new FormData();
            formData.append("contract", file);

            fetch("http://localhost:5000/detect", {
                method: "POST",
                body: formData
            })
                .then(response => response.json())
                .then(data => {
                    document.getElementById("output").innerText = data.message;
                    generateChart(data.message);
                })
                .catch(error => console.error("Error:", error));
        }

        function generateChart(message) {
            let canvasContainer = document.querySelector(".chart-container");
            let oldCanvas = document.getElementById("vulnChart");

            // Remove old canvas and create a new one to avoid conflicts
            if (oldCanvas) {
                oldCanvas.remove();
            }

            let newCanvas = document.createElement("canvas");
            newCanvas.id = "vulnChart";
            canvasContainer.appendChild(newCanvas);

            let ctx = newCanvas.getContext("2d");

            // Categorizing vulnerabilities
            const vulnerabilities = {
                "Reentrancy": (message.match(/reentrancy/i) || []).length,
                "Overflow/Underflow": (message.match(/overflow|underflow/i) || []).length,
                "Self-Destruct": (message.match(/selfdestruct/i) || []).length,
                "Uninitialized Storage": (message.match(/uninitialized/i) || []).length,
                "tx.origin Attack": (message.match(/tx.origin/i) || []).length
            };

            // Creating a chart with multiple vulnerability categories
            window.vulnChart = new Chart(ctx, {
                type: "bar",
                data: {
                    labels: Object.keys(vulnerabilities),
                    datasets: [{
                        label: "Vulnerability Count",
                        data: Object.values(vulnerabilities),
                        backgroundColor: ["#ff0000", "#ff7300", "#ffc107", "#007bff", "#28a745"]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }
    </script>
</body>

</html>